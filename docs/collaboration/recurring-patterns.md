# Recurring Patterns & Lessons Learned

Things that have gone wrong more than once or are easy to forget. Check this before starting translation, SEO, or multi-file work.

## Translation Work

### Always propagate to NL + PT when editing English
- Every content change to an English page needs parallel updates in `/nl/` and `/pt/` versions
- Every `meta.json` change needs `meta.nl.json` and `meta.pt.json` updates
- Every `content.html` change needs `content.nl.html` and `content.pt.html` updates
- Inline JS regexes that match translated heading text MUST be updated per language

### After translation edits, always re-run build.ts
```bash
~/.deno/bin/deno run --allow-read --allow-write build.ts
```
This regenerates all 93 blog pages (31 EN + 31 NL + 31 PT).

### Translation completeness checklist for CPR blog
The CPR blog has more translatable surfaces than regular blogs:
- [ ] Headings in `data-info` HTML strings
- [ ] `data-full-name` attributes (37 cards)
- [ ] Image `alt` texts (37 cards)
- [ ] JS regex patterns that match translated heading text
- [ ] Inline `<script>` block string literals (labels, tooltips)
- [ ] Inline `<style>` comments (low priority)

### thank-you.html is special
- Not generated by build.ts — must be manually maintained in EN/NL/PT
- Has its own footer (not injected by script.js) — must match other pages
- Has its own hreflang tags — must be kept in sync
- Has conversion pixel placeholder — preserve the comment when editing

## File Editing

### Long single-line attributes (CPR blog)
- `data-info` and `data-standards` are very long single-line HTML strings
- The Edit tool needs unique strings — use `grep -o` to extract the exact substring first
- `replace_all` works well for repeated patterns (like headings appearing in multiple cards)

### Edit tool requires Read first
- Every time you use `replace_all`, the read state is invalidated
- Re-read the file before the next edit batch

## Build & Deploy

### build.ts date locale
- Must be `en-GB` (not `en-US`) — line 106 in build.ts
- NL uses `nl-NL`, PT uses `pt-BR`

### Generated pages vs runtime i18n
- Static content (headings, paragraphs, meta tags) — baked into HTML by build.ts
- Dynamic UI (nav, footer, form labels, buttons) — swapped at runtime by i18n.js
- blog.js CTA form, share buttons, toasts — use t() helper which calls i18n.js
- script.js homepage features — some still hardcoded (see known-bugs.md)

## SEO / Structured Data

### hreflang tags
- Every page needs en + nl + pt-BR + x-default
- x-default always points to English version
- nl pages use `hreflang="nl"`, pt pages use `hreflang="pt-BR"`

### OG image
- Main pages: `/Images/og-image.png` (1200x630, <300KB)
- Blog posts: each has its own `featuredImage` in meta.json
- Blog listing + client-projects: use og-image.png (not WebsiteLander.svg)
